# Конфигурация для опроса расходомера ЭХО-Р02 программой MasterOPC Universal Modbus Server



**Расходомер** ЭХО-Р-02 предназначен для измерения объема (количества) протекающей жидкости, в том числе сточных вод, в открытых каналах шириной до 4-х и в безнапорных трубопроводах диаметром 100 мм и более с целью учета, в том числе коммерческого, в канализационных сетях, на очистных сооружениях, промышленных предприятиях. 

**Modbus Universal MasterOPC Server** сочетает в себе возможности *OPC-сервера* наиболее распространенного промышленного протокола передачи Modbus RTU/ASCII/TCP, а также инструментария для разработки новых *ОРС-серверов*, как для поддержки специализированных расширений *Modbus*, так и для поддержки любых иных протоколов. 

------

Сохранённый файл конфигурации *MasterOPC* для опроса расходомера находится в файле`Echo-R02.mbp`. В нём представлены три типа опроса:

- Опрос устройства в сети MODBUS по команде 03 (для ПО версии 3.5 и выше)
- Опрос устройства в сети MODBUS в режиме RTU по спец. командам User-Defined Function Codes (для ПО версии 3.1 и выше)
- Опрос устройства по двухточечном соединении RS232 (для ПО версии 3.1 и выше)

В каталогах сохранены экспортированные устройства по каждому типу опроса:
`ЭХО-Р02 485 (f03).sdv`
`ЭХО-Р02 485 (UDFC).sdv`
`ЭХО-Р02 232.sdv`

и исходные файлы скриптов на скриптов на встроенном
сценарном языке *Lua* применяемым в *Modbus Universal MasterOPC Server*.

### Опрашивается следующий список параметров:

***в сети MODBUS по команде 03:***

| Name             | Region            | DataType | Comment                                  |
| ---------------- | ----------------- | -------- | ---------------------------------------- |
| dev_status       | SERVER_ONLY       | double   | Код неисправности                        |
| H                | HOLDING_REGISTERS | float    | Уровень, м                               |
| Q                | HOLDING_REGISTERS | float    | Расход, м3/час                           |
| U                | HOLDING_REGISTERS | int32    | Отмасштабированное значение объёма    м3 |
| dev_working_time | HOLDING_REGISTERS | int32    | Время учета в минутах                    |
| dev_date_time    | HOLDING_REGISTERS | string   | Текущие значения даты и времени          |

***в сети MODBUS в режиме RTU по спец. командам UDFC:***

| Name                          | DataType | Comment                                                    |
| ----------------------------- | -------- | ---------------------------------------------------------- |
| EcoArchives{s}Archive_Q_hours | int16    | Почасовой HDA архив (настройка в свойствах подустройства)  |
| EcoArchives{s}Archive_Q_day   | int16    | Посуточный HDA архив (настройка в свойствах подустройства) |
| Status                        | int16    | Код неисправности прибора (0-неисправностей нет)           |
| H                             | int16    | Уровень, м                                                 |
| Q                             | int16    | Расход, м3/час                                             |
| U                             | int16    | Отмасштабированное значение объёма м3                      |
| Working_time                  | int16    | Время учета в минутах                                      |

***по двухточечном соединении RS232:***

| Name                          | DataType | Comment                                                    |
| ----------------------------- | -------- | ---------------------------------------------------------- |
| EcoArchives{s}Archive_Q_hours | int16    | Почасовой HDA архив (настройка в свойствах подустройства)  |
| EcoArchives{s}Archive_Q_day   | int16    | Посуточный HDA архив (настройка в свойствах подустройства) |
| Status                        | int16    | Код неисправности прибора (0-неисправностей нет)           |
| H                             | int16    | Уровень, м                                                 |
| Q                             | int16    | Расход, м3/час                                             |
| U                             | int16    | Отмасштабированное значение объёма м3                      |
| Working_time                  | int16    | Время учета в минутах                                      |
